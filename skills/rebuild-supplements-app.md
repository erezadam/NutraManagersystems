# Skill: Rebuild Supplements App

## 1) מטרת הפרויקט במשפט
לבנות מחדש את מערכת מאגר התוספים תוך שמירה מלאה על פונקציונליות, התנהגות עסקית, מבנה נתונים, וזרימות עבודה קיימות.

## 2) Definition of Done לכל יחידת עבודה
יחידת עבודה נחשבת מוכנה רק אם:
1. המימוש הושלם לפי דרישה מתועדת
2. בדיקות יחידה/אינטגרציה רלוונטיות עוברות
3. בוצעה בדיקה ידנית מינימלית לזרימה שהושפעה
4. מסמכי `docs/` עודכנו בהתאם לשינוי
5. סיכום שינוי נכתב (מה השתנה, למה, מה נבדק)
6. עמידה בכללי UX רוחביים למסכי תצוגה/עריכה (ראה סעיף חוקים)

## 3) חוקים שאסור לשבור

### ישויות ושדות
- לא לשנות שמות ישויות: `Vitamin`, `Food`, `DeficiencySymptom`, `Disease`, `Article`, `User`
- לא לשנות שמות שדות קיימים ללא ADR מפורש ב-`docs/decisions.md`
- לשמר שדות מערכת (`id`, `created_date`, `updated_date`, `created_by*`)
- בשינויי סכימה פונקציונלית:
  - אם שדה מסומן למחיקה UI, חובה לבצע מיזוג/העברה לשדה יעד לפני הסרה
  - אין למחוק מידע קיים; חובה מנגנון `read-merge-write` עם בדיקת כפילויות בסיסית
  - שדות legacy נשארים לקריאה בלבד עד אישור הסרה מלא

### ניווט
- לשמר מסכים: GlobalSearch, Vitamins, VitaminEdit, Diseases, DiseaseEdit, DeficiencySymptoms, Foods, Articles, ArticleEdit, UserManagement, 404
- לשמר deep-link של עריכה עם `?id=`

### Import/Export
- לשמר פורמטי JSON/CSV קיימים לכל ישות
- לשמר כללי זיהוי כפילויות:
  - Vitamin: `vitaminNameHe` או `vitaminNameEn`
  - Food: `foodNameHe`
  - Symptom: `symptomNameHe`
  - Disease: `diseaseNameHe`
  - Article: `titleHe`

### לוגיקות סנכרון
- לשמר סנכרון דו-כיווני תסמינים <-> מזונות
- לשמר סנכרון תוספים <-> תסמינים כפי שמוגדר ב-workflows
- לשמר תמיכה בנתוני legacy של Vitamin (`v.data` flatten + `labTestDeficiency`)

### כללי UX רוחביים (מחייב)
- לכל טופס חדש במערכת חייבים להיות שני מצבים נפרדים:
  - `תצוגה`: מציג את כל שדות הישות הקיימים, עם כותרת ברורה לכל שדה
  - `עדכון`: מכיל את כל שדות הישות לעדכון/עריכה
- במסכי תצוגה:
  - טקסט בתאים/שורות נחתך ל-2 שורות
  - תוכן גולש מציג סימון ופותח פופ-אפ בלחיצה
  - לחיצה נוספת על אותו שדה סוגרת את הפופ-אפ
- במסכי עריכה:
  - שדות טקסט חייבים להיות בעורך עשיר בסיסי עם תמיכה בצבע טקסט
  - השדה חייב להתרחב אוטומטית לפי גובה התוכן
  - אין להשאיר `textarea` קבוע למסכי עריכה עסקיים
- בשדות בחירה:
  - ברירת המחדל של שדה בחירה/בחירה מרובה היא מצב סגור
  - לחיצה על שורת החיפוש פותחת את הרשימה
  - הרשימה הפתוחה תומכת חיפוש וסימון ערכים
  - בשדה בחירה יחיד (Single Select) ניתן להגדיר ערכי בסיס + הוספת ערך חדש ללא מחיקת ערכים קיימים
- ב-toolbar של מסכי ניהול:
  - לשמור סדר אחיד של פעולות: `חיפוש` -> `חדש` -> `יצוא JSON` -> `יצוא CSV` -> `יבוא`
  - לשמור ניסוחים אחידים לכפתורים בין מסכים מקבילים

## 4) סגנון קוד וקונבנציות שמות
- TypeScript strict
- רכיבי React פונקציונליים בלבד
- שמות קבצים: PascalCase לרכיבים, kebab-case למסמכים
- פונקציות: verbNoun ברורות (`syncFoodSymptoms`, `importVitamins`)
- אין לוגיקה עסקית ב-UI קומפוננט ללא הפרדה ל-service/use-case
- lint+format מחייבים לפני מיזוג

## 5) תהליך עבודה קבוע
1. תכנון קצר
   - לנסח יעד שינוי, השפעות, וקריטריון קבלה מדיד
2. יישום
   - יחידה קטנה אחת בלבד בכל איטרציה
3. בדיקות
   - unit + בדיקת smoke ידנית
4. עדכון מסמכים
   - לעדכן לפחות קובץ מסמך אחד רלוונטי
5. סיכום שינוי
   - מה בוצע, מה נבדק, מה סיכון פתוח

## 6) בדיקות ידניות חובה לפני מיזוג
1. ניווט למסכים הראשיים (Desktop + Mobile width)
2. CRUD מלא לישות אחת לפחות
3. בדיקת סנכרון תסמין-מזון
4. בדיקת import/export לישות אחת (כולל duplicate skip)
5. בדיקת הרשאות:
   - admin רואה UserManagement
   - user לא רואה UserManagement
6. בדיקת AI במסך אחד
7. בדיקת build production + preview
8. בדיקת UX תצוגה: טקסט ארוך נחתך ל-2 שורות ונפתח/נסגר בפופ-אפ
9. בדיקת UX עריכה: שדה טקסט עשיר מתרחב, ושינויי צבע/עיצוב נשמרים
10. בדיקת UX שדות בחירה: ברירת מחדל סגורה, נפתחת מלחיצה על שורת חיפוש, ותומכת חיפוש+סימון
11. בדיקת מצבי טופס: לכל טופס יש גם מצב `תצוגה` מלא (כל השדות) וגם מצב `עדכון` מלא (כל השדות)
12. בדיקת אחידות toolbar: אותו סדר פעולות ושמות כפתורים בכל מסכי הניהול

## תוצרי חובה לכל PR
- קוד
- בדיקות
- עדכון מסמכים
- סעיף "הנחות/סיכונים" מעודכן אם יש שינוי התנהגות
